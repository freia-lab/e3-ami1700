# AMI 1700 device via socket interface

record(ai, "$(P)$(DEV)-V:sRdV") {
   field (DESC, "Probe's voltage")
   field (EGU, "V")
   field (DTYP, "stream")
   field (LOPR, "0")
   field (HOPR, "30.0")
   field (PREC, "2")
#   field (LOW, "150.0")
#   field (LOLO, "100.0")
#   field (LSV, "MINOR")
#   field (LLSV, "MAJOR")
   field (INP, "@ami.proto get_adc(0) $(PORT)")
   field (FLNK, "$(P)$(DEV)-V-smooth:sRdV")
   field (SCAN, "$(SCAN) second")
}
record(ai, "$(P)$(DEV)-V-smooth:sRdV") {
   field (DESC, "Smoothed probe's voltage")
   field (EGU, "V")
   field (DTYP, "Raw Soft Channel")
   field (LOPR, "0")
   field (HOPR, "100.0")
   field (SMOO, "0.95")
   field (PREC, "2")
   field (INP, "$(P)$(DEV)-V:sRdV")
   field (FLNK, "$(P)$(DEV)-R:sRdV")
}


record(ai, "$(P)$(DEV)-PS:sRdV") {
   field (DESC, "Probe's PS voltage")
   field (EGU, "V")
   field (DTYP, "stream")
   field (LOPR, "0")
   field (HOPR, "100.0")
   field (PREC, "2")
#   field (LOW, "150.0")
#   field (LOLO, "100.0")
#   field (LSV, "MINOR")
#   field (LLSV, "MAJOR")
   field (INP, "@ami.proto get_adc(1) $(PORT)")
   field (FLNK, "$(P)$(DEV)-PS-smooth:sRdV")
   field (SCAN, "$(SCAN) second")
}
record(ai, "$(P)$(DEV)-PS-smooth:sRdV") {
   field (DESC, "Smoothed probe's PS voltage")
   field (EGU, "V")
   field (DTYP, "Raw Soft Channel")
   field (LOPR, "0")
   field (HOPR, "100.0")
   field (SMOO, "0.95")
   field (PREC, "2")
   field (INP, "$(P)$(DEV)-PS:sRdV")
}


record(ai, "$(P)$(DEV)-I:sRdV") {
   field (DESC, "Probe's current")
   field (EGU, "mA")
   field (DTYP, "stream")
   field (LOPR, "0")
   field (HOPR, "75.0")
   field (PREC, "2")
#   field (LOW, "150.0")
#   field (LOLO, "100.0")
#   field (LSV, "MINOR")
#   field (LLSV, "MAJOR")
   field (INP, "@ami.proto get_adc(2) $(PORT)")
   field (FLNK, "$(P)$(DEV)-I-smooth:sRdV")
   field (SCAN, "$(SCAN) second")
}
record(ai, "$(P)$(DEV)-I-smooth:sRdV") {
   field (DESC, "Smoothed probe's current")
   field (EGU, "mA")
   field (DTYP, "Raw Soft Channel")
   field (LOPR, "0")
   field (HOPR, "75.0")
   field (SMOO, "0.95")
   field (PREC, "2")
   field (INP, "$(P)$(DEV)-I:sRdV")
}

record(ai, "$(P)$(DEV)-level:sRdV") {
   field (DESC, "Probe's LHe level")
   field (DTYP, "stream")
   field (LOPR, "0")
   field (HOPR, "100.0")
   field (PREC, "1")
   field (INP, "@ami.proto get_level $(PORT)")
   field (FLNK, "$(P)$(DEV)-level-smooth:sRdV")
   field (SCAN, "$(SCAN) second")
}
record(ai, "$(P)$(DEV)-level-smooth:sRdV") {
   field (DESC, "Smoothed probe's LHe level")
   field (DTYP, "Raw Soft Channel")
   field (LOPR, "0")
   field (HOPR, "100.0")
   field (SMOO, "0.95")
   field (PREC, "1")
   field (INP, "$(P)$(DEV)-level:sRdV")
}

record(ai, "$(P)$(DEV)-interval:sRdV") {
   field (DESC, "Probe's sampling interval")
   field (EGU, "min")
   field (DTYP, "stream")
   field (LOPR, "0")
   field (HOPR, "1.0")
   field (PREC, "2")
   field (INP, "@ami.proto get_interval $(PORT)")
   field (SCAN, "$(SCAN) second")
}

record(ai, "$(P)$(DEV)-length:sRdV") {
   field (DESC, "Probe's active length")
   field (DTYP, "stream")
   field (LOPR, "0")
   field (HOPR, "200.0")
   field (PREC, "2")
   field (INP, "@ami.proto get_length $(PORT)")
   field (SCAN, "$(SCAN) second")
}

record(mbbi,  "$(P)$(DEV):sEGU") {
   field (DESC, "Probe's EGU")
   field (ZRVL, "0")
   field (ZRST, "%")
   field (ONVL, "1")
   field (ONST, "cm")
   field (TWVL, "2")
   field (TWST, "inch")
   field (INP, "@ami.proto get_egu $(PORT)")
   field (SCAN, "$(SCAN) second")
   field (DTYP, "stream")
}

record (sseq, "$(P)$(DEV):sEGU-fanout") { 
   field (SCAN, "$(SCAN) second")
   field (DOL1, "$(P)$(DEV):sEGU")
   field (LNK1, "$(P)$(DEV)-level:sRdV.EGU PP") 
   field (DOL2, "$(P)$(DEV):sEGU")
   field (LNK2, "$(P)$(DEV)-level-smooth:sRdV.EGU PP") 
   field (DOL3, "$(P)$(DEV):sEGU")
   field (LNK3, "$(P)$(DEV)-length:sRdV.EGU PP") 
   field (DOL4, "$(P)$(DEV):sEGU")
   field (LNK4, "$(P)$(DEV)-length:cSetV.EGU PP") 
}

record(waveform, "$(P)$(DEV)-Id") {
   field (DESC, "Probe's id")
   field (DTYP, "stream")
   field (INP, "@ami.proto get_id $(PORT)")
   field (FTVL, "CHAR")
   field (NELM, "100")
   field (SCAN, "10 second")
}

record(mbbi,  "$(P)$(DEV):sConf") {
   field (DESC, "Controller's configuration")
   field (ZRVL, "0")
   field (ZRST, "Not for LHe")
   field (ZRSV, "MAJOR")
   field (ONVL, "1")
   field (ONST, "4.2K, ≤40 inches")
   field (TWVL, "2")
   field (TWST, "4.2K  ≤80 inches")
   field (THVL, "3")
   field (THST, "2K, ≤40 inches")
   field (FRVL, "4")
   field (FRST, "2K  ≤80 inches")
   field (INP, "@ami.proto get_conf $(PORT)")
   field (DTYP, "stream")
   field (SCAN, "10 second")
}

record(stringin, "$(P)$(DEV)-name:sRdV") {
   field (DESC, "Probe's name")
   field (DTYP, "stream")
   field (INP, "@ami.proto get_name $(PORT)")
   field (SCAN, "$(SCAN) second")
   field (PINI, "YES")
}

#############################################
# Calculated data
#############################################

record(calc, "$(P)$(DEV)-R:sRdV") {
   field (DESC, "Probe's resistance")
   field (EGU, "Ώ")
   field (PREC, "1")
   field (INPA, "$(P)$(DEV)-I:sRdV")
   field (INPB, "$(P)$(DEV)-V:sRdV")
   field (CALC, "A#0?1000.0*B/A:-1")
   field (LOW, "-0.5")
   field (LSV, "MAJOR")
   field (FLNK, "$(P)$(DEV)-R-smooth:sRdV")
}

record(calc, "$(P)$(DEV)-R-smooth:sRdV") {
   field (DESC, "Probe's resistance")
   field (EGU, "Ώ")
   field (PREC, "1")
   field (INPA, "$(P)$(DEV)-I-smooth:sRdV")
   field (INPB, "$(P)$(DEV)-V-smooth:sRdV")
   field (CALC, "A#0?1000.0*B/A:-1")
   field (LOW, "-0.5")
   field (LSV, "MAJOR")
}

record(stringin, "$(P)$(DEV)-IPaddr") {
   field (DESC, "Controller's IP address")
   field (VAL, "$(AMI_IP)")
   field (PINI, "YES")
}

#############################################
# Commands and settings
#############################################

record(bo, "$(P)$(DEV):cmdSH") {
   field (DESC, "Set Sample and Hold mode")
   field (DTYP, "stream")
   field (OUT, "@ami.proto set_hold $(PORT)")
}

record(bo, "$(P)$(DEV):cmdCont") {
   field (DESC, "Set Continuous mode")
   field (DTYP, "stream")
   field (OUT, "@ami.proto set_cont $(PORT)")
}

record(mbbo, "$(P)$(DEV):cEGU") {
   field (DESC, "Select EGU")
   field (DTYP, "stream")
   field (ZRVL, "0")
   field (ZRST, "%")
   field (ONVL, "1")
   field (ONST, "cm")
   field (TWVL, "2")
   field (TWST, "inch")
   field (OUT, "@ami.proto set_egu $(PORT)")
}

record(ao,  "$(P)$(DEV)-length:cSetV") {
   field (DESC, "Probe's active length")
   field (EGU, "cm")
   field (DTYP, "stream")
   field (LOPR, "0")
   field (HOPR, "200.0")
   field (PREC, "2")
   field (OUT, "@ami.proto set_length $(PORT)")
}

record(ao, "$(P)$(DEV)-interval:cSetV") {
   field (DESC, "Probe's sampling interval")
   field (EGU, "min")
   field (DTYP, "stream")
   field (LOPR, "0")
   field (HOPR, "60.0")
   field (PREC, "2")
   field (OUT, "@ami.proto set_interval $(PORT)")
}

record(stringout, "$(P)$(DEV)-name:cSetV") {
   field (DESC, "Probe's name")
   field (DTYP, "stream")
   field (OUT, "@ami.proto set_name $(PORT)")
}
